<tool id="pm_muairss_read" name="Cluster outputs (pm-muairss read)" version="0.1.0" python_template_version="3.5">
    <requirements>
        <requirement type="package">pymuonsuite</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        unzip $optimised &&
        if test -f "params.yaml"; then echo "params.yaml present"; else echo "params.yaml missing" && exit 64; fi
        && if test -f "input.cell"; then echo "input.cell present"; else echo "input.cell missing" && exit 64; fi
        && out_folder="`python ${__tool_directory__}/get_out_folder.py`" &&
        pm-muairss -t r input.cell params.yaml
    ]]></command>
    <inputs>
        <param type="data" name="optimised" format="zip" />
    </inputs>
    <outputs>
        <data label="Cluster report for $optimised.name" name="out_cluster" format="txt" from_work_dir="$out_folder/*clusters.txt"/>
        <data label="Cluster data for $optimised.name" name="out_cluster_dat" format="txt" from_work_dir="$out_folder/*clusters.dat"/>
    </outputs>
    <tests>
        <test>
            <param name="optimised" value="uep-out.zip" ftype='zip'/>
            <output name="out_cluster" file="clustout-uep.txt" ftype="txt" compare="sim_size" delta="20"/>
            <output name="out_cluster_dat" file="clustout-uep.dat" ftype="txt" compare="sim_size" delta="20"/>
        </test>
        <test>
            <param name="optimised" value="dftb-out.zip" ftype='zip'/>
            <output name="out_cluster" file="clustout-dftb.txt" ftype="txt" compare="sim_size" delta="20"/>
            <output name="out_cluster_dat" file="clustout-dftb.dat" ftype="txt" compare="sim_size" delta="20"/>
        </test>
    </tests>
    <help><![CDATA[
        usage: pm-muairss [-h] -t r structures parameter_file

        Given a set of optimised input structures, clusters the structures based on similarity.
    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{github,
  author = {Muon Spectroscopy Computational Project},
  year = {2021},
  title = {pymuon-suite},
  publisher = {GitHub},
  journal = {GitHub repository},
  url = {https://github.com/muon-spectroscopy-computational-project/pymuon-suite/},
}</citation>
    </citations>
</tool>
